<!DOCTYPE html>
<html>
<head>
    <title>–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –í–∏–∫—Ç–æ—Ä–∏–Ω–∞</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background: #0b1a2b; color: white; }
        .avatar-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 20px; }
        .avatar-grid img { width: 100%; border-radius: 50%; border: 3px solid transparent; }
        .avatar-grid img.selected { border-color: gold; }
        .btn { display: block; width: 80%; margin: 10px auto; padding: 15px; background: #c41e3a; color: white; border: none; border-radius: 5px; font-size: 1.1em; }
        #q-image { max-width: 90%; border-radius: 10px; margin-top: 20px; }
    </style>
</head>
<body>
    <div id="setup">
        <h1>üéÑ –¢–≤–æ–π –ì–µ—Ä–æ–π</h1>
        <input type="text" id="username" placeholder="–¢–≤–æ—ë –∏–º—è" style="padding: 10px; width: 70%;">
        <div class="avatar-grid" id="avatars"></div>
        <button class="btn" onclick="join()">–í–æ–π—Ç–∏ –≤ –∏–≥—Ä—É</button>
    </div>

    <div id="game" style="display:none">
        <img id="q-image" src="">
        <h2 id="q-text"></h2>
        <div id="options"></div>
    </div>

    <script>
        const socket = io();
        let myAvatar = "";

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–µ—Ç–∫—É –∞–≤–∞—Ç–∞—Ä–æ–≤
        const grid = document.getElementById('avatars');
        for(let i=1; i<=8; i++) {
            const img = document.createElement('img');
            img.src = `/images/avatars/solo/avatar${i}.png`;
            img.onclick = () => {
                document.querySelectorAll('.avatar-grid img').forEach(el => el.classList.remove('selected'));
                img.classList.add('selected');
                myAvatar = img.src;
            };
            grid.appendChild(img);
        }

        function join() {
            const name = document.getElementById('username').value;
            if (name && myAvatar) {
                socket.emit('joinGame', { name, avatar: myAvatar });
                document.getElementById('setup').style.display = 'none';
                document.getElementById('game').style.display = 'block';
            }
        }

        socket.on("gameState", (state) => {
            if (state.status === "QUESTION" && state.question) {
                document.getElementById('q-image').src = state.question.image;
                document.getElementById('q-text').innerText = state.question.text;
                const opts = document.getElementById('options');
                opts.innerHTML = "";
                Object.entries(state.question.options).forEach(([key, val]) => {
                    const b = document.createElement('button');
                    b.className = "btn";
                    b.innerText = val;
                    b.onclick = () => socket.emit("submitAnswer", key);
                    opts.appendChild(b);
                });
            }
        });
    </script>
</body>
</html>
