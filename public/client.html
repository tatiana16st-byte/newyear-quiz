<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–í–∏–∫—Ç–æ—Ä–∏–Ω–∞</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: Arial; text-align: center; background: #111; color: #fff; }
    .avatars img { width: 60px; border-radius: 50%; margin: 5px; cursor: pointer; border: 2px solid transparent; }
    .avatars img.selected { border-color: gold; }
    .answers button { display: block; margin: 10px auto; padding: 10px; width: 80%; }
  </style>
</head>
<body>

<h1>üéÑ –í–∏–∫—Ç–æ—Ä–∏–Ω–∞</h1>

<div id="join">
  <input id="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" /><br><br>

  <div class="avatars">
    <img src="/images/avatars/solo/avatar1.png" onclick="selectAvatar(1)">
    <img src="/images/avatars/solo/avatar2.png" onclick="selectAvatar(2)">
    <img src="/images/avatars/solo/avatar3.png" onclick="selectAvatar(3)">
    <img src="/images/avatars/solo/avatar4.png" onclick="selectAvatar(4)">
    <img src="/images/avatars/solo/avatar5.png" onclick="selectAvatar(5)">
    <img src="/images/avatars/solo/avatar6.png" onclick="selectAvatar(6)">
    <img src="/images/avatars/solo/avatar7.png" onclick="selectAvatar(7)">
    <img src="/images/avatars/solo/avatar8.png" onclick="selectAvatar(8)">
  </div>

  <br>
  <button onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
</div>

<div id="waiting" style="display:none">
  ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã‚Ä¶
</div>

<div id="game" style="display:none">
  <h2 id="question"></h2>
  <img id="questionImage" style="max-width:300px; display:none"><br>
  <div class="answers" id="answers"></div>
</div>

<script>
const socket = io();
let selectedAvatar = null;

function selectAvatar(num) {
  selectedAvatar = num;
  document.querySelectorAll('.avatars img').forEach(img => img.classList.remove('selected'));
  document.querySelectorAll('.avatars img')[num - 1].classList.add('selected');
}

function startGame() {
  const name = document.getElementById('name').value;
  if (!name || !selectedAvatar) {
    alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä");
    return;
  }

  socket.emit("joinGame", {
    name,
    avatar: selectedAvatar
  });

  document.getElementById('join').style.display = "none";
  document.getElementById('waiting').style.display = "block";
}

/* ===== GAME STARTED ===== */
socket.on("game_started", () => {
  document.getElementById('waiting').style.display = "none";
  document.getElementById('game').style.display = "block";
});

/* ===== QUESTION ===== */
socket.on("question", (q) => {
  document.getElementById("question").innerText = q.question;

  const img = document.getElementById("questionImage");
  if (q.imagePath) {
    img.src = q.imagePath;
    img.style.display = "block";
  } else {
    img.style.display = "none";
  }

  const answers = document.getElementById("answers");
  answers.innerHTML = "";

  Object.entries(q.options).forEach(([key, text]) => {
    const btn = document.createElement("button");
    btn.innerText = `${key}: ${text}`;
    answers.appendChild(btn);
  });
});
</script>

</body>
</html>
