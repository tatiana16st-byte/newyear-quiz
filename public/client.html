<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–í–∏–∫—Ç–æ—Ä–∏–Ω–∞</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    .avatars img {
      width: 60px;
      border-radius: 50%;
      margin: 5px;
      cursor: pointer;
      border: 2px solid transparent;
    }
    .avatars img.selected {
      border-color: green;
    }
  </style>
</head>
<body>

<h1>–í–∏–∫—Ç–æ—Ä–∏–Ω–∞</h1>

<div id="join">
  <input id="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" />
  <div class="avatars" id="avatars"></div>
  <button id="joinBtn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
</div>

<p id="status"></p>

<div id="questionBlock" style="display:none;">
  <h2 id="question"></h2>
  <div id="answers"></div>
</div>

<script>
  const socket = io();

  const avatarsDiv = document.getElementById("avatars");
  const joinBtn = document.getElementById("joinBtn");
  const status = document.getElementById("status");
  const questionBlock = document.getElementById("questionBlock");
  const questionEl = document.getElementById("question");
  const answersEl = document.getElementById("answers");

  let selectedAvatar = null;

  // –∞–≤–∞—Ç–∞—Ä—ã 1‚Äì8
  for (let i = 1; i <= 8; i++) {
    const img = document.createElement("img");
    img.src = `/images/avatars/solo/avatar${i}.png`;
    img.onclick = () => {
      document.querySelectorAll(".avatars img").forEach(a => a.classList.remove("selected"));
      img.classList.add("selected");
      selectedAvatar = img.src;
    };
    avatarsDiv.appendChild(img);
  }

  joinBtn.onclick = () => {
    const name = document.getElementById("name").value;
    if (!name || !selectedAvatar) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä");

    socket.emit("joinGame", { name, avatar: selectedAvatar });
    status.textContent = "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã‚Ä¶";
  };

  socket.on("game_started", () => {
    status.textContent = "üéÆ –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!";
  });

  socket.on("question", (q) => {
    questionBlock.style.display = "block";
    questionEl.textContent = q.question;
    answersEl.innerHTML = "";

    Object.entries(q.options).forEach(([key, text]) => {
      const btn = document.createElement("button");
      btn.textContent = `${key}: ${text}`;
      answersEl.appendChild(btn);
    });
  });
</script>

</body>
</html>
